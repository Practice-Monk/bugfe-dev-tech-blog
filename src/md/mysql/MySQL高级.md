# MySQL升级打怪中...
## 3 存储引擎
在MySQL8中提供了很多的存储引擎，不同的存储引擎的特点是不一样的，常见的存储引擎有：**InnoDB**、**MyISAM**、Memory、Archive(高压缩比)、Blackhole（黑洞）、CSV引擎、Federated引擎等。
### 3.1 **查看存储引擎**
***
查看MySQL提供什么存储引擎

**SHOW ENGINES;**

查看MySQL提供什么存储引擎
```sql
SHOW ENGINES;
```

下面的结果表示MySQL中默认使用的存储引擎是InnoDB，支持事务，行锁，外键等。

![img.png](img/img.png)

也可以通过以下语句查看默认的存储引擎：

```sql
SHOW VARIABLES LIKE '%default_storage_engine%';
```
![查看默认存储引擎.png](img/查看默认存储引擎.png)

### 3.2 **主要的存储引擎介绍**
***
#### 3.2.1 **InnoDB**
##### **特点介绍**
1、默认存储引擎：在MySQL 5.5版本之后，InnoDB成为了MySQL的默认存储引擎。
2、支持事务：InnoDB是一个支持ACID事务的存储引擎，可以提供数据的一致性和可靠性。
3、行级锁定：InnoDB使用行级锁定来实现并发控制，允许多个事务同时读取和写入不同的行，提高了并发性能。
4、外键约束：InnoDB支持外键约束.
5、支持崩溃恢复：InnoDB具有崩溃恢复机制，可以在数据库异常关闭后进行恢复。

#### 3.2.2 **MyISAM**
##### **特点介绍**

1、不支持事务：MyISAM是一个不支持事务的存储引擎，无法提供数据的一致性和可靠性。
2、表级锁定：MyISAM使用表级锁定来实现并发控制，只允许一个事务对整个表进行读写操作，限制了并发性能。
3、较低的存储空间占用：相比InnoDB，MyISAM在存储空间占用方面较低，适合存储大量非事务性的数据。

#### 3.2.3 **MyISAM和InnoDB的对比**
| **对比项**             |                         **MyISAM**                          |                          **InnoDB**                          |
| ---------------------- | :---------------------------------------------------------: | :----------------------------------------------------------: |
| 外键                   |                           不支持                            |                             支持                             |
| 事务                   |                           不支持                            |                             支持                             |
| XA                     |                           不支持                            |                             支持                             |
| 行表锁                 |  表锁，即使修改一条记录也会锁住整个表，不适合高并发的操作   |  行锁,修改时只锁某一行，不对其它行有影响，适合高并发的操作   |
| savePoint              |                           不支持                            |                             支持                             |
| 文件类型               | **.myd**、**.myi**、<strong style="color:red">.frm</strong> |      **.ibd**、<strong style="color:red">.frm</strong>       |
| 缓存（5.7）            |                 只缓存索引，不缓存真实数据                  | 不仅缓存索引还要缓存真实数据，对内存要求较高，而且内存大小对性能有决定性的影响 |
| 聚簇（主键）索引       |                           不支持                            |                             支持                             |
| 默认使用               |                              N                              |                              Y                               |
| count(*)/不带where条件 |                             快                              |                              慢                              |
| 使用场景               |  不需要事务支持、并发相对较低、数据相对修改较少、以读为主   |        需要事务支持、并发相对较高、数据更新较为频繁。        |

.frm在mysql8中移除掉了，存储的是库或表的结构。
InnoDB中的 **.ibd** 存储的是数据和索引。而**MyISAM**中 **.myd** 存的是数据、**.myi**存的是索引。

```sql
select count(*)  from user;---若查询记录数时带了条件，那么MyIsam更快一些。
select count(*)  from  user where age=18;----若查询记录数时带了条件，那么一样快。
```

## 4 MySQL索引入门
***

### 4.1 索引概述
***
MySQL官方对索引的定义为：索引（index）是帮助MySQL高效获取数据的**数据结构**（有序）。在数据之外，数据库系统还维护者满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据， 这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。如下面的示意。

> 【5,10，2,1,6,8】------id=8
>
> 排序
>
> 【1,2,5,6,8,10】----算法（折半）
>
>
>
> id     name      age;（普通索引、唯一索引）---age建立索引---在底层要给age的这些值排序
>
> 1     ‘ls’     10
>
> 2     ‘zs’     8
>
> 3     ‘ww’     11
>
> 4     ‘zl’     1
>
> age(索引): 1 8 10 11

![索引.png](img/索引.png)

>利用二叉查找树（排序）树，既能有顺序的将那些无序的元素，变为有序，而且还自带了一种折半的思想算法在里面。因此这用树作为索引结构而不去用数组+算法作为所以会更加的方便。


左边是数据表，一共有两列七条记录，最左边的是数据记录的物理地址（注意逻辑上相邻的记录在磁盘上也并不是一定物理相邻的）。为了加快Col2的查找，可以维护一个右边所示的二叉查找树，每个节点分别包含索引键值和一个指向对应数据记录物理地址的指针，这样就可以运用二叉查找快速获取到相应数据。一般来说索引本身也很大，不可能全部存储在内存中，因此索引往往以索引文件的形式**存储在磁盘上**。索引是数据库中用来提高性能的最常用的优化手段。